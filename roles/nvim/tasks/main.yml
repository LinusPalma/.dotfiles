---
#-----------------#
#  install nvim   #
#-----------------#

- name: Install nvim (Arch, Fedora)
  package:
    name: neovim
    state: present
  become: yes
  tags: [server, client]
  when: ansible_distribution in ["Archlinux", "Fedora"]

# - name: Add Neovim PPA (Ubunut)
#   ansible.builtin.apt_repository:
#     repo: ppa:neovim-ppa/unstable
#     state: present
#   tags: [server, client]
#   when: ansible_distribution == "Ubuntu"

# - name: Install Neovim from PPA (Ubuntu)
#   ansible.builtin.apt:
#     name: neovim
#     state: present
#     update_cache: yes
#   tags: [server, client]
#   when: ansible_distribution == "Ubuntu"
- name: Install Neovim via snap (Ubuntu)
  ansible.builtin.command:
    cmd: snap install nvim --classic
    creates: /snap/bin/nvim
  become: yes
  tags: [server, client]
  when: ansible_distribution == "Ubuntu"

#----------------------------------------#
#   Install Node + NPM (dependencies)    #
#----------------------------------------#

- name: Install Node + NPM
  package:
    name:
      - nodejs
      - npm
      - unzip
      - python3.12-venv # only in Ubunut / Debian!
    state: present
  become: yes
  tags: [server, client]
  when: ansible_distribution in ["Ubuntu", "Debian"]
#--------------------------------------#
#   Install Treesitter dependencies    #
#--------------------------------------#
#TODO: add for Arch, debian, fedora
- name: Install Treesitter deps (Ubuntu)
  package:
    name:
      - build-essential
      - gcc
      - git
    state: present
  become: yes
  tags: [server, client]
  when: ansible_distribution == "Ubuntu"

#---------------------------------------#
#   Install fd (depencencie telescope   #
#---------------------------------------#

- name: install fd (Arch)
  package:
    name: fd
    state: present
  become: yes
  tags: [server, client]
  when: ansible_distribution in ["Archlinux"]

- name: install fd (Ubuntu, Fedora)
  package:
    name: fd-find
    state: present
  become: yes
  tags: [server, client]
  when: ansible_distribution in ["Ubuntu","Fedora"]

#-----------------------------#
#   create config directory   #
#-----------------------------#

- name: Create nvim config directory
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim"
    state: directory
  tags: [server, client]

## Symlinking conigs

#------------------------#
#   Symlinking configs   #
#------------------------#

- name: Copy nvim config directory
  #  file:
  copy:
    src: ./
    dest: "{{ ansible_env.HOME }}/.config/nvim"
    #  state: link
    force: yes
  tags: [server, client]
