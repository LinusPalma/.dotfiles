---
#--------------------------#
#  install gh cli + copilot #
#--------------------------#

- name: Install gh cli (Archlinux)
  package:
    name: github-cli
    state: present
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] == "Archlinux"

- name: Install gh cli (Ubuntu/Debian)
  block:
    - name: Add GitHub CLI GPG key
      ansible.builtin.get_url:
        url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
        dest: /usr/share/keyrings/githubcli-archive-keyring.gpg
        mode: "0644"

    - name: Add GitHub CLI repository
      ansible.builtin.apt_repository:
        repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"
        state: present
        filename: github-cli

    - name: Install gh cli
      package:
        name: gh
        state: present
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] in ["Ubuntu", "Debian"]

- name: Install gh cli (Fedora)
  ansible.builtin.dnf:
    name: gh
    state: present
    use_backend: dnf4
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] == "Fedora"

- name: Install npm (Archlinux)
  package:
    name: npm
    state: present
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] == "Archlinux"

- name: Install npm (Ubuntu/Debian)
  package:
    name: npm
    state: present
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] in ["Ubuntu", "Debian"]

- name: Install npm (Fedora)
  ansible.builtin.dnf:
    name: npm
    state: present
    use_backend: dnf4
  become: yes
  tags: [server, client]
  when: ansible_facts['distribution'] == "Fedora"

- name: Install GitHub Copilot CLI
  community.general.npm:
    name: "@github/copilot"
    global: yes
    state: present
  become: yes
  tags: [server, client]
